<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="eci.pdsw.mybatis.mappers.EquipoMapper">
    
    <resultMap type='Usuario' id='UsuarioResult'>
        <id property='id' column='id'/>
        <result property='nombre' column='nombre'/>
        <result property='correo' column='correo'/>      
        <result property='contrasena' column='contrasena'/>
        <collection property='prestamos' ofType='Prestamo' resultMap="PrestamoResult" columnPrefix="pre_"></collection>
    </resultMap>
    
    <resultMap type='Prestamo' id='PrestamoResult'>
        <id property='usuario_id' column='USUARIOS_id'/>
        <id property='equipo_serial' column='EQUIPOS_serial'/>
        <result property='fechaExpedicion' column='fechaExpedicion'/>
        <result property='fechaVencimiento' column='fechaVencimiento'/>        
        <result property='tipoPrestamo' column='tipoPrestamo'/>
    </resultMap>   
   
    <select id='loadUsuarioById' parameterType='map' resultMap='UsuarioResult'>
        SELECT us.id,us.nombre,us.correo,us.contrasena,
               pre.USUARIOS_id as pre_usuario_id,pre.EQUIPOS_serial as pre_equipo_serial,pre.fechaExpedicion as pre_fechaExpedicion,pre.fechaVencimiento as pre_fechaVencimiento,pre.tipoPrestamo as pre_tipoPrestamo
        FROM USUARIOS as us left join PRESTAMOS as pre on pre.USUARIOS_id=us.id 
        WHERE us.id=#{idusuario}        
    </select>
</mapper>
    